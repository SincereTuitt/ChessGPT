(()=>{"use strict";var r={38:(r,e,t)=>{function n(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=o(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,s=!0,c=!1;return{s:function(){t=t.call(r)},n:function(){var r=t.next();return s=r.done,r},e:function(r){c=!0,u=r},f:function(){try{s||null==t.return||t.return()}finally{if(c)throw u}}}}function a(r){return function(r){if(Array.isArray(r))return u(r)}(r)||function(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||o(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(r,e){if(r){if("string"==typeof r)return u(r,e);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?u(r,e):void 0}}function u(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}var s=t(629);function c(r,e,t,n,o,u){if(r<=0)return u;var f=i(u,t,e,o,n);if(!f.length)return{w:1/0,b:-1/0,sm:0,"3mr":0,"50mr":0}[s.isGameOver(t,e,o).toString()];var v=f.map((function(a){var o=s.getPawnJumpPrevious(t,a.move[0],a.move[1],e),u=s.updateCastlingOptions(n,t,a.move[0],a.move[1],e);return c(r-.5,"w"===e?"b":"w",a.boardState,u,o,a.score)}));return"w"===e?Math.max.apply(Math,a(v)):Math.min.apply(Math,a(v))}function i(r,e,t,a,o){for(var u=[],c={kw:0,kb:0,"-":0,rw:5,nw:3,bw:3,qw:9,pw:1,rb:-5,nb:-3,bb:-3,qb:-9,pb:-1},i=0;i<8;i++)for(var f=0;f<8;f++){var v,p=s.getMoves(e,[i,f],t,a,o),l=n(p.moves.concat(p.captures));try{for(l.s();!(v=l.n()).done;){var b=v.value,m=[[i,f],b],h=r-c[e[b[0]][b[1]]],w=s.updateBoard(e,[i,f],b,t);u.push({move:m,score:h,boardState:w})}}catch(r){l.e(r)}finally{l.f()}}return u}e.CI=function(r,e,t,a,o){var u=i(function(r){var e,t=0,a={kw:0,kb:0,"-":0,rw:5,nw:3,bw:3,qw:9,pw:1,rb:-5,nb:-3,bb:-3,qb:-9,pb:-1},o=n(r);try{for(o.s();!(e=o.n()).done;){var u,s=n(e.value);try{for(s.s();!(u=s.n()).done;)t+=a[u.value]}catch(r){s.e(r)}finally{s.f()}}}catch(r){o.e(r)}finally{o.f()}return t}(t),t,e,o,a).map((function(n){var o=s.getPawnJumpPrevious(t,n.move[0],n.move[1],e),u=s.updateCastlingOptions(a,t,n.move[0],n.move[1],e);return n.score=c(r-.5,"w"===e?"b":"w",n.boardState,u,o,n.score),n}));return function(r,e){var t,a=void 0,o=[],u=n(e);try{for(u.s();!(t=u.n()).done;){var s=t.value;void 0!==a&&s.score!==a||(a=s.score,o.push(s.move)),("w"===r&&s.score>a||"b"===r&&s.score<a)&&(a=s.score,o.length=0,o.push(s.move))}}catch(r){u.e(r)}finally{u.f()}return o[Math.floor(Math.random()*o.length)]}(e,u)}},629:(r,e)=>{function t(r,e){return function(r){if(Array.isArray(r))return r}(r)||function(r,e){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var n,a,o,u,s=[],c=!0,i=!1;try{if(o=(t=t.call(r)).next,0===e){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=o.call(t)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(r){i=!0,a=r}finally{try{if(!c&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(i)throw a}}return s}}(r,e)||function(r,e){if(r){if("string"==typeof r)return n(r,e);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?n(r,e):void 0}}(r,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function a(r,e,t,n,a){var u=r[e[0]][e[1]],b={moves:[],captures:[]};if("-"===u||u[1]!==t)return b;switch(u[0]){case"r":b=c(r,e,t);break;case"n":b=f(r,e,t);break;case"b":b=v(r,e,t);break;case"q":b=p(r,e,t);break;case"k":b=l(r,e,t,a);break;case"p":b=i(r,e,t,n)}return b.moves=b.moves.filter((function(n){return!o(s(r,e,n,t),t)})),b.captures=b.captures.filter((function(n){return!o(s(r,e,n,t),t)})),b}function o(r,e){var n,a;r:for(var o=0;o<8;o++)for(var u=0;u<8;u++)if(r[o][u]==="k"+e){n=o,a=u;break r}for(var s=0;s<8;s++)for(var b=0;b<8;b++){var m=r[s][b];if("-"!==m&&m[1]!==e)switch(m[0]){case"r":if(c(r,[s,b],"w"===e?"b":"w").captures.some((function(r){var e=t(r,2),o=e[0],u=e[1];return o===n&&u===a})))return!0;break;case"n":if(f(r,[s,b],"w"===e?"b":"w").captures.some((function(r){var e=t(r,2),o=e[0],u=e[1];return o===n&&u===a})))return!0;break;case"b":if(v(r,[s,b],"w"===e?"b":"w").captures.some((function(r){var e=t(r,2),o=e[0],u=e[1];return o===n&&u===a})))return!0;break;case"q":if(p(r,[s,b],"w"===e?"b":"w").captures.some((function(r){var e=t(r,2),o=e[0],u=e[1];return o===n&&u===a})))return!0;break;case"k":if(l(r,[s,b],"w"===e?"b":"w").captures.some((function(r){var e=t(r,2),o=e[0],u=e[1];return o===n&&u===a})))return!0;break;case"p":if(i(r,[s,b],"w"===e?"b":"w",!1).captures.some((function(r){var e=t(r,2),o=e[0],u=e[1];return o===n&&u===a})))return!0}}return!1}function u(r,e,t){for(var n=0;n<8;n++)for(var o=0;o<8;o++){var u=a(r,[n,o],e,t);if(u.moves.length||u.captures.length)return!1}return!0}function s(r,e,n,a){var o=t(e,2),u=o[0],s=o[1],c=t(n,2),i=c[0],f=c[1],v=JSON.parse(JSON.stringify(r)),p=r[u][s][0];return"p"===p&&"-"===r[i][f]&&s!==f&&(v["w"===a?i-1:i+1][f]="-"),"k"===p&&4===s&&6===f&&(v[u][7]="-",v[u][5]="r".concat(a)),"k"===p&&4===s&&2===f&&(v[u][0]="-",v[u][3]="r".concat(a)),v[i][f]=r[u][s],v[u][s]="-",v}function c(r,e,t){for(var n={moves:[],captures:[]},a=e[0],o=e[1],u=a+1,s=o;u<8;u++){var c=r[u][s];if("-"!==c){if(c[1]===t)break;n.captures.push([u,s]);break}n.moves.push([u,s])}for(var i=a-1,f=o;i>=0;i--){var v=r[i][f];if("-"!==v){if(v[1]===t)break;n.captures.push([i,f]);break}n.moves.push([i,f])}for(var p=a,l=o+1;l<8;l++){var b=r[p][l];if("-"!==b){if(b[1]===t)break;n.captures.push([p,l]);break}n.moves.push([p,l])}for(var m=a,h=o-1;h>=0;h--){var w=r[m][h];if("-"!==w){if(w[1]===t)break;n.captures.push([m,h]);break}n.moves.push([m,h])}return n}function i(r,e,t,n){var a={moves:[],captures:[]},o=e[0],u=e[1];switch(t){case"w":"-"===r[o+1][u]&&a.moves.push([o+1,u]),1===o&&"-"===r[o+1][u]&&"-"===r[o+2][u]&&a.moves.push([o+2,u]),r[o+1][u+1]&&"-"!==r[o+1][u+1]&&r[o+1][u+1][1]!==t&&a.captures.push([o+1,u+1]),r[o+1][u-1]&&"-"!==r[o+1][u-1]&&r[o+1][u-1][1]!==t&&a.captures.push([o+1,u-1]),n&&n[0]===o&&n[1]===u+1&&a.captures.push([o+1,u+1]),n&&n[0]===o&&n[1]===u-1&&a.captures.push([o+1,u-1]);break;case"b":"-"===r[o-1][u]&&a.moves.push([o-1,u]),6===o&&"-"===r[o-1][u]&&"-"===r[o-2][u]&&a.moves.push([o-2,u]),r[o-1][u+1]&&"-"!==r[o-1][u+1]&&r[o-1][u+1][1]!==t&&a.captures.push([o-1,u+1]),r[o-1][u-1]&&"-"!==r[o-1][u-1]&&r[o-1][u-1][1]!==t&&a.captures.push([o-1,u-1]),n&&n[0]===o&&n[1]===u+1&&a.captures.push([o-1,u+1]),n&&n[0]===o&&n[1]===u-1&&a.captures.push([o-1,u-1])}return a}function f(r,e,n){var a={moves:[],captures:[]},o=e[0],u=e[1];return[[o+1,u+2],[o+1,u-2],[o-1,u+2],[o-1,u-2],[o+2,u+1],[o+2,u-1],[o-2,u+1],[o-2,u-1]].forEach((function(e){var o=t(e,2),u=o[0],s=o[1];if(!(u>7||s>7||u<0||s<0)){var c=r[u][s];"-"===c?a.moves.push([u,s]):c[1]!==n&&a.captures.push([u,s])}})),a}function v(r,e,t){for(var n={moves:[],captures:[]},a=e[0],o=e[1],u=a+1,s=o+1;u<8&&s<8;u++,s++){var c=r[u][s];if("-"!==c){if(c[1]===t)break;n.captures.push([u,s]);break}n.moves.push([u,s])}for(var i=a+1,f=o-1;i<8&&f>=0;i++,f--){var v=r[i][f];if("-"!==v){if(v[1]===t)break;n.captures.push([i,f]);break}n.moves.push([i,f])}for(var p=a-1,l=o+1;p>=0&&l<8;p--,l++){var b=r[p][l];if("-"!==b){if(b[1]===t)break;n.captures.push([p,l]);break}n.moves.push([p,l])}for(var m=a-1,h=o-1;m>=0&&h>=0;m--,h--){var w=r[m][h];if("-"!==w){if(w[1]===t)break;n.captures.push([m,h]);break}n.moves.push([m,h])}return n}function p(r,e,t){var n=v(r,e,t),a=c(r,e,t);return{moves:n.moves.concat(a.moves),captures:n.captures.concat(a.captures)}}function l(r,e,t,n){var a={moves:[],captures:[]},u=e[0],s=e[1];if([[u+1,s+1],[u+1,s-1],[u-1,s+1],[u-1,s-1],[u-1,s],[u+1,s],[u,s+1],[u,s-1]].forEach((function(e){var n=e[0],o=e[1];if(!(n>7||n<0||o>7||o<0)){var u=r[n][o];"-"===u?a.moves.push([n,o]):u[1]!==t&&a.captures.push([n,o])}})),n&&!n["k".concat(t)]&&!o(r,t)){var c=JSON.parse(JSON.stringify(r));c[u][s]="-",c[u][5]="k".concat(t),n["r".concat(t,"7")]||"-"!==r[u][5]||"-"!==r[u][6]||o(c,t)||a.moves.push([u,6]),c[u][5]="-",c[u][3]="k".concat(t),n["r".concat(t,"0")]||"-"!==r[u][1]||"-"!==r[u][2]||"-"!==r[u][3]||o(c,t)||a.moves.push([u,2])}return a}Object.defineProperty(e,"__esModule",{value:!0}),e.getMoves=a,e.isInCheck=o,e.noLegalMoves=u,e.isGameOver=function(r,e,t){return o(r,e)&&u(r,e,t)?"w"===e?"b":"w":!(o(r,e)||!u(r,e,t))&&"sm"},e.getPawnJumpPrevious=function(r,e,n,a){var o=t(e,2),u=o[0],s=o[1],c=t(n,2),i=c[0],f=c[1];return"p"===r[u][s][0]&&u===("w"===a?1:6)&&i===("w"===a?3:4)&&[i,f]},e.updateBoard=s,e.updateCastlingOptions=function(r,e,t,n,a){var o=Object.assign({},r),u=e[t[0]][t[1]],s=e[n[0]][n[1]],c="w"===a?"b":"w";return"k"===u[0]&&(o["k".concat(a)]=!0),"r"===u[0]&&t[0]===("w"===a?0:7)&&0===t[1]&&(o["r".concat(a,"0")]=!0),"r"===u[0]&&t[0]===("w"===a?0:7)&&7===t[1]&&(o["r".concat(a,"7")]=!0),"r"===s[0]&&n[0]===("w"===a?7:0)&&7===n[1]&&(o["r".concat(c,"7")]=!0),"r"===s[0]&&n[0]===("w"===a?7:0)&&0===n[1]&&(o["r".concat(c,"0")]=!0),o},e.rookMoves=c,e.pawnMoves=i,e.knightMoves=f,e.bishopMoves=v,e.queenMoves=p,e.kingMoves=l}},e={},t=function t(n){var a=e[n];if(void 0!==a)return a.exports;var o=e[n]={exports:{}};return r[n](o,o.exports,t),o.exports}(38);self.addEventListener("message",(function(r){if("getEngineMove"===r.data.request){var e=r.data,n=e.depth,a=e.currentPlayer,o=e.boardState,u=e.movedCastlers,s=e.pawnJumpPrevious,c=(0,t.CI)(n,a,o,u,s);postMessage({move:c})}}))})();